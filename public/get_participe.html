
<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <title>Confirma√ß√£o de Presen√ßa - DETIN</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  </head>
  <body class="bg-gray-100 text-gray-800 p-4">
    <div class="max-w-4xl mx-auto bg-white rounded-2xl shadow p-6">
      <h1 class="text-2xl font-bold mb-6 text-center">
        Confirma√ß√£o de Participa√ß√£o - DETIN
      </h1>

      <!-- Carrossel -->
      <div class="mb-5 relative w-full overflow-hidden rounded-xl h-64">
        <div
          id="carousel"
          class="flex transition-transform duration-500 ease-in-out w-full h-full"
        >
          <img
            src="../imagem/foto_01.jpeg"
            class="w-full h-full object-cover flex-shrink-0"
          />
          <img
            src="../imagem/foto_02.jpeg"
            class="w-full h-full object-cover flex-shrink-0"
          />
          <img
            src="../imagem/foto_03.png"
            class="w-full h-full object-cover flex-shrink-0"
          />
        </div>
      </div>

      <script>
        const carousel = document.getElementById("carousel");
        const slides = carousel.children;
        const totalSlides = slides.length;
        let currentIndex = 0;

        function updateCarousel() {
          const slideWidth = slides[0].offsetWidth;
          carousel.style.transform = `translateX(-${
            currentIndex * slideWidth
          }px)`;
        }

        setInterval(() => {
          currentIndex = (currentIndex + 1) % totalSlides;
          updateCarousel();
        }, 3000);

        window.addEventListener("resize", updateCarousel);
      </script>

      <!-- Descri√ß√£o -->
      <p class="text-center text-gray-600 mb-2"><b>üéâ Comunicado ‚Äì Festa de Fim de Ano 2025 üéâ</b></p>
        <p class="text-center text-gray-600 mb-2"></p>  
        <p class="text-center text-gray-600 mb-2">Prezados(as) colegas,</p>
        <p class="text-center text-gray-600 mb-4">
        √â com grande entusiasmo que anunciamos nosso Jantar de Fim de Ano, que ser√° realizado no dia 27 de dezembro (s√°bado), no Vidas Buffet.
        Abaixo, seguem as informa√ß√µes importantes sobre o evento:</p>
        <p class="text-center text-gray-600 mb-2">
        üí∞ Valores de participa√ß√£o:</p>
        <p class="text-center text-gray-600 mb-2">* Servidores: R$ 200,00</p>
        <p class="text-center text-gray-600 mb-2">* Estagi√°rios: R$ 120,00</p>
        <p class="text-center text-gray-600 mb-2">* Acompanhantes: R$ 200,00</p>
        <p class="text-center text-gray-600 mb-2">* Crian√ßas:</p>
        <p class="text-center text-gray-600 mb-2">‚ó¶ De 04 a 10 anos: R$ 100,00</p>
        <p class="text-center text-gray-600 mb-2">‚ó¶ De 11 a 14 anos: R$ 120,00</p>  
        <p class="text-center text-gray-600 mb-2">Os valores poder√£o ser parcelados em at√© 8 vezes, com in√≠cio dos pagamentos previsto para abril/maio. O valor total deve estar quitado at√©, no m√°ximo, novembro.</p>
        <p class="text-center text-gray-600 mb-2">üì¢ Aten√ß√£o: Solicitamos que todos os servidores manifestem seu interesse em participar o quanto antes, para que possamos organizar o evento da melhor forma poss√≠vel.</p>
        <p class="text-center text-gray-600 mb-4"></p>

      <form class="space-y-4" id="confirmacaoForm">
        <div>
          <label class="block mb-1 font-semibold">Setor:</label>
          <select id="setor" class="w-full border rounded px-3 py-2" required>
            <option value="">Selecione um setor</option>
          </select>
        </div>

        <div>
          <label class="block mb-1 font-semibold">Nome:</label>
          <select id="colaborador" class="w-full border rounded px-3 py-2" required>
            <option value="">Selecione o nome</option>
          </select>
        </div>

        <div id="tipoContratacaoWrapper" class="hidden">
          <label class="block mb-1 font-semibold">Tipo de Contrata√ß√£o:</label>
          <input id="tipoContratacao" type="text" class="w-full border rounded px-3 py-2 bg-gray-100" readonly />
        </div>

        <div>
          <label class="block mb-1 font-semibold">Voc√™ ir√° participar?</label>
          <select id="participar" class="w-full border rounded px-3 py-2" required>
            <option value="">Selecione</option>
            <option value="sim">Sim</option>
            <option value="nao">N√£o</option>
          </select>
        </div>

        <div id="acompanhantesWrapper" class="hidden">
          <label class="block mb-1 font-semibold">Acompanhantes maiores de 18 anos:</label>
          <input type="number" id="acomp_18" min="0" max="10" value="0" class="w-full border rounded px-3 py-2" />

          <label class="block mb-1 font-semibold mt-2">Acompanhantes de 11 a 17 anos:</label>
          <input type="number" id="acomp_11_17" min="0" max="10" value="0" class="w-full border rounded px-3 py-2" />

          <label class="block mb-1 font-semibold mt-2">Acompanhantes de 04 a 10 anos:</label>
          <input type="number" id="acomp_4_10" min="0" max="10" value="0" class="w-full border rounded px-3 py-2" />

          <label class="block mb-1 font-semibold mt-4">Total a Pagar:</label>
          <input type="text" id="total" readonly class="w-full border rounded px-3 py-2 bg-gray-100 font-bold" />
        </div>

        <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
          Confirmar
        </button>
      </form>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const setorSelect = document.getElementById("setor");
        const colaboradorSelect = document.getElementById("colaborador");
        const tipoContratacaoInput = document.getElementById("tipoContratacao");
        const tipoContratacaoWrapper = document.getElementById("tipoContratacaoWrapper");
        const participarSelect = document.getElementById("participar");
        const confirmacaoForm = document.getElementById("confirmacaoForm");
        const acompanhantesWrapper = document.getElementById("acompanhantesWrapper");
        const acomp18 = document.getElementById("acomp_18");
        const acomp11_17 = document.getElementById("acomp_11_17");
        const acomp4_10 = document.getElementById("acomp_4_10");
        const totalInput = document.getElementById("total");

        function calcularTotal() {
          let tipo = tipoContratacaoInput.value;
          let base = tipo === "Estagi√°rio" ? 120 : 200;
          let v18 = 200 * parseInt(acomp18.value || 0);
          let v11_17 = 120 * parseInt(acomp11_17.value || 0);
          let v4_10 = 100 * parseInt(acomp4_10.value || 0);
          totalInput.value = `R$ ${(base + v18 + v11_17 + v4_10).toFixed(2).replace(".", ",")}`;
        }

        [acomp18, acomp11_17, acomp4_10].forEach((el) => {
          el.addEventListener("input", calcularTotal);
        });

        function carregarSetores() {
          fetch("../backend/get_setores.php")
            .then((r) => r.json())
            .then((setores) => {
              setores.forEach((setor) => {
                const option = document.createElement("option");
                option.value = setor;
                option.textContent = setor;
                setorSelect.appendChild(option);
              });
            });
        }

        // Fun√ß√£o para carregar colaboradores com base no setor selecionado
        function carregarColaboradores(setorId) {
          colaboradorSelect.innerHTML =
            '<option value="">Selecione o nome</option>'; // Resetar op√ß√µes

          if (!setorId) return; // N√£o carregar se nenhum setor for selecionado

          fetch(`../backend/get_colaboradores.php?setor=${encodeURIComponent(setorId)}`)
            .then((response) => {
              if (!response.ok) {
                throw new Error("Erro ao carregar colaboradores");
              }
              return response.json();
            })
            .then((colaboradores) => {
              console.log("Colaboradores carregados:", colaboradores); // Log para depura√ß√£o

              if (colaboradores.error) {
                console.error("Erro:", colaboradores.error);
                return;
              }

              // Preencher o dropdown com os colaboradores
              colaboradores.forEach((colaborador) => {
                const option = document.createElement("option");
                option.value = colaborador.id;
                option.textContent = colaborador.nome;
                colaboradorSelect.appendChild(option);
              });
            })
            .catch((error) => console.error("Erro ao carregar colaboradores:", error));
        }

        // Evento para carregar colaboradores ao selecionar um setor
        setorSelect.addEventListener("change", () => {
          const setorId = setorSelect.value;
          console.log("Setor selecionado:", setorId); // Log para depura√ß√£o
          carregarColaboradores(setorId);
        });

        setorSelect.addEventListener("change", () => {
          carregarColaboradores(setorSelect.value);
        });

        colaboradorSelect.addEventListener("change", () => {
          const selected = colaboradorSelect.selectedOptions[0];
          const tipo = selected?.dataset?.tipo || "";
          if (tipo) {
            tipoContratacaoInput.value = tipo;
            tipoContratacaoWrapper.classList.remove("hidden");
            calcularTotal();
          }
        });

        participarSelect.addEventListener("change", () => {
          if (participarSelect.value === "sim") {
            acompanhantesWrapper.classList.remove("hidden");
            calcularTotal();
          } else {
            acompanhantesWrapper.classList.add("hidden");
            totalInput.value = "";
          }
        });

        confirmacaoForm.addEventListener("submit", async (e) => {
          e.preventDefault();
          const dados = {
            colaborador_id: colaboradorSelect.value,
            vai_participar: participarSelect.value,
            tipo_contratacao: tipoContratacaoInput.value,
            acomp_18: acomp18.value,
            acomp_11_17: acomp11_17.value,
            acomp_4_10: acomp4_10.value
          };

          const response = await fetch("../backend/confirmar.php", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(dados)
          });
          const result = await response.json();

          if (result.status === "ok") {
            Swal.fire("Sucesso!", "Sua confirma√ß√£o foi enviada!", "success");
            confirmacaoForm.reset();
            tipoContratacaoWrapper.classList.add("hidden");
            acompanhantesWrapper.classList.add("hidden");
            totalInput.value = "";
          } else {
            Swal.fire("Erro!", result.message || "Erro ao gravar os dados.", "error");
          }
        });

        carregarSetores();
      });
    </script>
  </body>
</html>
